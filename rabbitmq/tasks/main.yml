---
# tasks file for rabbitmq
- name: Installing erlang
  apt:
   name: erlang
   state: present
   
- name: Installing RabbitMQ
  apt:
   name: rabbitmq-server
   state: present
   
- name: Starting rabbitmq-server
  service:
   name: rabbitmq-server
   state: started
   enabled: true
   
- name: Enabling the rabbit-mq management server
  shell: rabbitmq-plugins enable rabbitmq_management
  ignore_errors: yes

- name: Adding the rabbitmq admin user and password
  shell: rabbitmqctl add_user admin password 
  ignore_errors: yes
  
- name: Configuring the rabbitmq admin user user_tag
  shell: rabbitmqctl set_user_tags admin administrator
  ignore_errors: yes
  
- name: Configuring the rabbitmq admin user permissions
  shell: rabbitmqctl set_permissions -p / admin ".*" ".*" ".*"
  ignore_errors: yes

- name: Starting rabbitmq-server
  service:
   name: rabbitmq-server
   state: restarted
   enabled: true
